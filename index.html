<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD MONITORING IBSTR BANDUNG BARAT TAHUN 2025</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS untuk mempercantik tampilan -->
    <style>
        body {
            background-color: #f0f2f5; /* Warna latar belakang body yang lebih lembut */
        }
        .card {
            border: none; /* Menghilangkan border pada card */
            box-shadow: 0 4px 8px rgba(0,0,0,0.05); /* Memberi bayangan agar card terlihat 'mengambang' */
        }
        .card-metric h5 {
            font-size: 1rem; /* Ukuran font untuk judul metric */
            color: #fff;
            opacity: 0.9;
        }
        .card-metric h3 {
            font-size: 2.2rem; /* Ukuran font untuk nilai metric */
            font-weight: 700;
            color: #fff;
        }
        /* Definisi warna gradasi untuk 5 card metric */
        .gradient-1 { background: linear-gradient(45deg, #007bff, #0056b3); }
        .gradient-2 { background: linear-gradient(45deg, #28a745, #1e7e34); }
        .gradient-3 { background: linear-gradient(45deg, #ffc107, #d39e00); }
        .gradient-4 { background: linear-gradient(45deg, #dc3545, #b02a37); }
        .gradient-5 { background: linear-gradient(45deg, #17a2b8, #117a8b); }
        
        .chart-container {
            position: relative;
            height: 40vh; /* Tinggi container grafik, 40% dari tinggi viewport */
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-3">
        <!-- Judul Dashboard -->
        <div class="row mb-3">
            <div class="col-md-9">
                <h3 class="fw-bold">DASHBOARD MONITORING IBSTR BANDUNG BARAT TAHUN 2025</h3>
                <p class="text-muted"> Hasil Pencacahan Yang Diambil Dari Sampel Utama dan Sampel Cadangan</p>
            </div>
            <div class="col-md-3 d-flex align-items-center justify-content-end">
                <div class="w-100">
                    <label for="metricDateFilter" class="form-label fw-bold">Pilih Tanggal</label>
                    <select id="metricDateFilter" class="form-select"></select>
                </div>
            </div>
        </div>

        <!-- BARIS PERTAMA: 5 CARD METRIC -->
        <div class="row g-3 mb-4">
            <!-- Card 1: Target Sampel -->
            <div class="col-xl col-lg-4 col-md-6 col-12">
                <div class="card card-metric gradient-1 text-white">
                    <div class="card-body">
                        <h5 id="metricTargetSampelTitle">Target Sampel</h5>
                        <h3 id="metricTargetSampelValue">0</h3>
                    </div>
                </div>
            </div>
            <!-- Card 2: Sampel Aktif Eligle -->
            <div class="col-xl col-lg-4 col-md-6 col-12">
                <div class="card card-metric gradient-2 text-white">
                    <div class="card-body">
                        <h5 id="metricAktifEligleTitle">Aktif Eligle</h5>
                        <h3 id="metricAktifEligleValue">0</h3>
                    </div>
                </div>
            </div>
            <!-- Card 3: Sampel Aktif Non Eligle -->
            <div class="col-xl col-lg-4 col-md-6 col-12">
                <div class="card card-metric gradient-3 text-white">
                    <div class="card-body">
                        <h5 id="metricAktifNonEligleTitle">Aktif Non Eligle</h5>
                        <h3 id="metricAktifNonEligleValue">0</h3>
                    </div>
                </div>
            </div>
            <!-- Card 4: Lainnya (Tutup, dll) -->
            <div class="col-xl col-lg-6 col-md-6 col-12">
                <div class="card card-metric gradient-4 text-white">
                    <div class="card-body">
                        <h5 id="metricLainnyaTitle">Lainnya (Tutup, dll)</h5>
                        <h3 id="metricLainnyaValue">0</h3>
                    </div>
                </div>
            </div>
            <!-- Card 5: % Perusahaan Eligle -->
            <div class="col-xl col-lg-6 col-md-12 col-12">
                <div class="card card-metric gradient-5 text-white">
                    <div class="card-body">
                        <h5 id="metricPersenEligleTitle">% Prsh Aktif Eligle</h5>
                        <h3 id="metricPersenEligleValue">0.00 %</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- BARIS KEDUA: TABEL REKAP PENCAPAIAN -->
        <div class="row g-3 mb-4">
            <!-- Kolom Tabel 1: REKAP PENCAPAIAN PENCACAHAN SIBSTR TAHUN 2025 -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header fw-bold">
                        REKAP PENCAPAIAN PENCACAHAN SIBSTR TAHUN 2025
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped table-hover table-sm">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Aktif Eligle</th>
                                    <th>Aktif Non Eligle</th>
                                    <th>Lainnya (Tutup, dll)</th>
                                </tr>
                            </thead>
                            <tbody id="rekapPencapaianTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Kolom Tabel 2: Pencapaian per Pencacah -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header fw-bold">
                        Pencapaian Hasil Pencacahan IBSTR per Petugas (Berdasarkan Tanggal)
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-striped table-hover table-sm">
                            <thead>
                                <tr>
                                    <th>Nama Pencacah</th>
                                    <th>Aktif Eligle</th>
                                    <th>Aktif Non Eligle</th>
                                    <th>Lainnya (Tutup, dll)</th>
                                </tr>
                            </thead>
                            <tbody id="pencacahTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- BARIS KETIGA: GRAFIK -->
        <div class="row mb-3">
            <div class="col-md-12">
                 <label for="chartDateFilter" class="form-label fw-bold">Pilih Tanggal untuk Grafik (Bisa lebih dari satu)</label>
                 <select id="chartDateFilter" class="form-select" multiple>
                    <!-- Opsi bulan akan ditambahkan oleh JavaScript -->
                 </select>
            </div>
        </div>

        <div class="row g-3">
            <!-- Kolom Grafik 1: Grafik Batang -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header fw-bold">
                        Perbandingan Hasil Pencacahn Pertanggal
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Kolom Grafik 2: Grafik Garis (Spline) -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header fw-bold">
                        Tren Hasil Pencacahan Pertanggal
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="lineChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- Akhir dari container-fluid -->

    <script>
        // --- DATA DARI GAMBAR ---
        const dataPencacahanHarian = [
            { Tanggal: '07 NOVEMBER 25', short: '07 Nov', 'Target Sampel': 73, 'Aktif Eligle': 51, 'Aktif Non Eligle': 11, 'Lainnya (Tutup, dll)': 35, '% Prsh Eligle': 69.90 },
            { Tanggal: '10 NOVEMBER 25', short: '10 Nov', 'Target Sampel': 73, 'Aktif Eligle': 51, 'Aktif Non Eligle': 11, 'Lainnya (Tutup, dll)': 37, '% Prsh Eligle': 69.90 },
            { Tanggal: '11 NOVEMBER 25', short: '11 Nov', 'Target Sampel': 73, 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 0, '% Prsh Eligle': 0.00 },
            { Tanggal: '12 NOVEMBER 25', short: '12 Nov', 'Target Sampel': 73, 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 0, '% Prsh Eligle': 0.00 },
            { Tanggal: '13 NOVEMBER 25', short: '13 Nov', 'Target Sampel': 73, 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 0, '% Prsh Eligle': 0.00 },
            { Tanggal: '14 NOVEMBER 25', short: '14 Nov', 'Target Sampel': 73, 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 0, '% Prsh Eligle': 0.00 },
            { Tanggal: '15 NOVEMBER 25', short: '15 Nov', 'Target Sampel': 73, 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 0, '% Prsh Eligle': 0.00 },
        ];

        const dataPerPencacah = {
            '07 NOVEMBER 25': [
                { 'Nama Pencacah': 'DEDEH', 'Aktif Eligle': 18, 'Aktif Non Eligle': 4, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'IIN', 'Aktif Eligle': 3, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'IMAS', 'Aktif Eligle': 1, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 4 },
                { 'Nama Pencacah': 'NINGRUM', 'Aktif Eligle': 8, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 4 },
                { 'Nama Pencacah': 'RITA', 'Aktif Eligle': 16, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'ROSAD', 'Aktif Eligle': 1, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SITI', 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 0 },
                { 'Nama Pencacah': 'SUHERMAN', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'TINI', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 0 },
                { 'Nama Pencacah': 'YULIANI', 'Aktif Eligle': 2, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 2 },
            ],
            '10 NOVEMBER 25': [
                { 'Nama Pencacah': 'DEDEH', 'Aktif Eligle': 18, 'Aktif Non Eligle': 4, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'IIN', 'Aktif Eligle': 3, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'IMAS', 'Aktif Eligle': 1, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 4 },
                { 'Nama Pencacah': 'NINGRUM', 'Aktif Eligle': 8, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'RITA', 'Aktif Eligle': 16, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'ROSAD', 'Aktif Eligle': 1, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SITI', 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SUHERMAN', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'TINI', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 0 },
                { 'Nama Pencacah': 'YULIANI', 'Aktif Eligle': 2, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 2 },
            ],
            '11 NOVEMBER 25': [],
                { 'Nama Pencacah': 'DEDEH', 'Aktif Eligle': 18, 'Aktif Non Eligle': 4, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'IIN', 'Aktif Eligle': 3, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'IMAS', 'Aktif Eligle': 1, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 4 },
                { 'Nama Pencacah': 'NINGRUM', 'Aktif Eligle': 8, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'RITA', 'Aktif Eligle': 16, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'ROSAD', 'Aktif Eligle': 1, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SITI', 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SUHERMAN', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'TINI', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 0 },
                { 'Nama Pencacah': 'YULIANI', 'Aktif Eligle': 2, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 2 },
            ],
            '12 NOVEMBER 25': [],
                { 'Nama Pencacah': 'DEDEH', 'Aktif Eligle': 18, 'Aktif Non Eligle': 4, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'IIN', 'Aktif Eligle': 3, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'IMAS', 'Aktif Eligle': 1, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 4 },
                { 'Nama Pencacah': 'NINGRUM', 'Aktif Eligle': 8, 'Aktif Non Eligle': 2, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'RITA', 'Aktif Eligle': 16, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 9 },
                { 'Nama Pencacah': 'ROSAD', 'Aktif Eligle': 1, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SITI', 'Aktif Eligle': 0, 'Aktif Non Eligle': 0, 'Lainnya (Tutup, dll)': 1 },
                { 'Nama Pencacah': 'SUHERMAN', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 5 },
                { 'Nama Pencacah': 'TINI', 'Aktif Eligle': 1, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 0 },
                { 'Nama Pencacah': 'YULIANI', 'Aktif Eligle': 2, 'Aktif Non Eligle': 1, 'Lainnya (Tutup, dll)': 2 },
            ],
            '13 NOVEMBER 25': [],
            '14 NOVEMBER 25': [],
            '15 NOVEMBER 25': [],
        };

        // --- Variabel Global untuk Grafik ---
        let barChart;
        let lineChart;

        // --- FUNGSI-FUNGSI UTAMA ---

        function formatNumerik(angka) {
            if (angka === null || isNaN(angka)) return '0';
            return new Intl.NumberFormat('id-ID').format(angka);
        }
        
        function formatPersen(angka) {
            if (angka === null || isNaN(angka)) return '0.00 %';
            return angka.toFixed(2) + ' %';
        }

        function updateMetrics(selectedDate) {
            const dataTanggalIni = dataPencacahanHarian.find(d => d.Tanggal === selectedDate);
            
            if (dataTanggalIni) {
                document.getElementById('metricTargetSampelTitle').innerHTML = `Target Sampel (${dataTanggalIni.short})`;
                document.getElementById('metricTargetSampelValue').textContent = formatNumerik(dataTanggalIni['Target Sampel']);

                document.getElementById('metricAktifEligleTitle').innerHTML = `Aktif Eligle (${dataTanggalIni.short})`;
                document.getElementById('metricAktifEligleValue').textContent = formatNumerik(dataTanggalIni['Aktif Eligle']);

                document.getElementById('metricAktifNonEligleTitle').innerHTML = `Aktif Non Eligle (${dataTanggalIni.short})`;
                document.getElementById('metricAktifNonEligleValue').textContent = formatNumerik(dataTanggalIni['Aktif Non Eligle']);
                
                document.getElementById('metricLainnyaTitle').innerHTML = `Lainnya (Tutup, dll) (${dataTanggalIni.short})`;
                document.getElementById('metricLainnyaValue').innerHTML = formatNumerik(dataTanggalIni['Lainnya (Tutup, dll)']);

                document.getElementById('metricPersenEligleTitle').innerHTML = `% Prsh Aktif Eligle (${dataTanggalIni.short})`;
                document.getElementById('metricPersenEligleValue').innerHTML = formatPersen(dataTanggalIni['% Prsh Eligle']);

                updatePencacahTable(selectedDate);
            } else {
                document.getElementById('metricTargetSampelValue').textContent = '0';
                document.getElementById('metricAktifEligleValue').textContent = '0';
                document.getElementById('metricAktifNonEligleValue').textContent = '0';
                document.getElementById('metricLainnyaValue').innerHTML = '0';
                document.getElementById('metricPersenEligleValue').innerHTML = '0.00 %';

                document.getElementById('metricTargetSampelTitle').innerHTML = `Target Sampel`;
                document.getElementById('metricAktifEligleTitle').innerHTML = `Aktif Eligle`;
                document.getElementById('metricAktifNonEligleTitle').innerHTML = `Aktif Non Eligle`;
                document.getElementById('metricLainnyaTitle').innerHTML = `Lainnya (Tutup, dll)`;
                document.getElementById('metricPersenEligleTitle').innerHTML = `% Prsh Aktif Eligle`;

                updatePencacahTable(selectedDate);
            }
        }
        
        function populateRekapPencapaianTable() {
            const tbody = document.getElementById('rekapPencapaianTableBody');
            tbody.innerHTML = '';
            dataPencacahanHarian.forEach(data => {
                const row = `
                    <tr>
                        <td>${data.Tanggal}</td>
                        <td>${formatNumerik(data['Aktif Eligle'])}</td>
                        <td>${formatNumerik(data['Aktif Non Eligle'])}</td>
                        <td>${formatNumerik(data['Lainnya (Tutup, dll)'])}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function updatePencacahTable(selectedDate) {
            const tbody = document.getElementById('pencacahTableBody');
            tbody.innerHTML = '';
            
            const dataUntukTanggalIni = dataPerPencacah[selectedDate];
            
            if (dataUntukTanggalIni && dataUntukTanggalIni.length > 0) {
                dataUntukTanggalIni.forEach(data => {
                    const row = `
                        <tr>
                            <td>${data['Nama Pencacah']}</td>
                            <td>${formatNumerik(data['Aktif Eligle'])}</td>
                            <td>${formatNumerik(data['Aktif Non Eligle'])}</td>
                            <td>${formatNumerik(data['Lainnya (Tutup, dll)'])}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } else {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center">Data pencacah untuk tanggal ${selectedDate} tidak tersedia.</td></tr>`;
            }
        }

        function updateCharts(selectedDates) {
            const filteredData = dataPencacahanHarian.filter(d => selectedDates.includes(d.Tanggal));

            // Sort data by date for correct chart display
            filteredData.sort((a, b) => {
                const dateA = new Date(a.Tanggal.replace(/(\d+)\s(\w+)\s(\d+)/, '$2 $1 $3'));
                const dateB = new Date(b.Tanggal.replace(/(\d+)\s(\w+)\s(\d+)/, '$2 $1 $3'));
                return dateA - dateB;
            });

            const labels = filteredData.map(d => d.short);
            const AktifEligleData = filteredData.map(d => d['Aktif Eligle']);
            const AktifNonEligleData = filteredData.map(d => d['Aktif Non Eligle']);
            const lainnyaData = filteredData.map(d => d['Lainnya (Tutup, dll)']);

            const chartDatasets = [
                {
                    label: 'Aktif Eligle',
                    data: AktifEligleData,
                    backgroundColor: 'rgba(67, 28, 234, 0.7)',
                    borderColor: 'rgba(67, 28, 234, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Aktif Non Eligle',
                    data: AktifNonEligleData,
                    backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Lainnya (Tutup, dll)',
                    data: lainnyaData,
                    backgroundColor: 'rgba(252, 45, 10, 0.7)',
                    borderColor: 'rgba(252, 45, 10, 1)',
                    borderWidth: 1
                }
            ];
            
            if (barChart) {
                barChart.data.labels = labels;
                barChart.data.datasets = chartDatasets;
                barChart.update();
            }

            if (lineChart) {
                const lineChartDatasets = JSON.parse(JSON.stringify(chartDatasets));
                lineChartDatasets.forEach(ds => {
                    ds.tension = 0.4;
                    ds.fill = false;
                });

                lineChart.data.labels = labels;
                lineChart.data.datasets = lineChartDatasets;
                lineChart.update();
            }
        }

        function initDashboard() {
            const metricFilter = document.getElementById('metricDateFilter');
            const chartFilter = document.getElementById('chartDateFilter');
            
            // Populate date options for both filters
            dataPencacahanHarian.forEach(data => {
                metricFilter.innerHTML += `<option value="${data.Tanggal}">${data.Tanggal}</option>`;
                // Initially select all dates for the chart filter
                chartFilter.innerHTML += `<option value="${data.Tanggal}" selected>${data.Tanggal}</option>`;
            });

            // Set metric filter to the latest date available
            if (dataPencacahanHarian.length > 0) {
                metricFilter.value = dataPencacahanHarian[dataPencacahanHarian.length - 1].Tanggal;
            }

            populateRekapPencapaianTable();

            const barCtx = document.getElementById('barChart').getContext('2d');
            barChart = new Chart(barCtx, {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatNumerik(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            const lineCtx = document.getElementById('lineChart').getContext('2d');
            lineChart = new Chart(lineCtx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false } },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatNumerik(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            // Initial update for metrics and charts
            const initialMetricDate = metricFilter.value;
            updateMetrics(initialMetricDate);
            
            const initialChartDates = Array.from(chartFilter.selectedOptions).map(opt => opt.value);
            updateCharts(initialChartDates);
            
            metricFilter.addEventListener('change', (e) => {
                updateMetrics(e.target.value);
            });
            
            chartFilter.addEventListener('change', (e) => {
                const selected = Array.from(e.target.selectedOptions).map(opt => opt.value);
                updateCharts(selected);
            });
        }

        document.addEventListener('DOMContentLoaded', initDashboard);

    </script>
</body>
</html>
